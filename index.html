<!-- /index.html -->
<!DOCTYPE html>
<html lang="de" translate="no" class="no-js">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="description" content="Kurzer 2-Minuten-Finanz-Check â€“ ehrlich, ohne Verkauf. Finde heraus, wo bei dir Geld liegen bleibt und wie du mehr Ruhe im Kopf bekommst." />
  <meta property="og:title" content="2-Minuten-Finanz-Check" />
  <meta property="og:description" content="Kurzer Finanz-Check der zeigt, wo du stehst â€“ anonym, ohne Verkauf, sofort Ergebnis." />
  <meta property="og:type" content="website" />
  <title>2-Minuten-Finanz-Check</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>

  <!-- ğŸ”§ Upgrade 1: Micro-Commitment Loader -->
  <div id="micro-loader" class="micro-loader" role="status" aria-live="polite">
    <div class="micro-loader-box">
      <div class="micro-loader-dot" aria-hidden="true"></div>
      <p class="micro-loader-text">Seite ist bereit â€“ du entscheidest</p>
    </div>
  </div>

  <!-- Decision Anchor + ğŸ”§ Upgrade 5: Micro-Proof Loop -->
  <div class="decision-anchor" id="decision-anchor" role="note" aria-live="polite">
    ğŸ”’ 100% <span class="critical-highlight">anonym</span> Â·
    <span class="critical-highlight">kein Verkauf</span> Â·
    <span class="critical-highlight">25 â‚¬</span> Garantie Â·
    <span id="micro-proof" class="micro-proof">keine Vorbereitung notwendig</span>
  </div>

  <!-- Sticky CTA -->
  <div class="sticky-cta tap-scale" id="sticky-cta" aria-hidden="true">
    ğŸ‘‰ Finanz-Check starten und mehr Ruhe im Kopf bekommen
  </div>

  <!-- Bottom Nav (App-like) -->
  <nav class="bottom-nav" id="bottom-nav">
    <a href="#hero" class="nav-item is-active"><span>ğŸ </span><span>Home</span></a>
    <a href="#quiz" class="nav-item"><span>ğŸš¦</span><span>Finanzcheck</span></a>
    <a href="#referral" class="nav-item"><span>ğŸ’¬</span><span>Weitergeben</span></a>
    <a href="#termin" class="nav-item"><span>ğŸ“</span><span>Termin</span></a>
  </nav>

  <!-- HERO -->
  <header id="hero" class="hero surface fade-up" role="banner">
    <div class="wrap hero-wrap">
      <div class="hero-text">
        <h1 id="hero-headline">
          In <span class="critical-highlight">2 Minuten</span> sehen, ob bei dir Geld liegen bleibt â€“ ohne Druck, <span class="critical-highlight">kein Verkauf</span>.
        </h1>
        <p id="hero-subheadline" class="subhead">
          Kurzer 2-Fragen-Check â€“ <span class="critical-highlight">anonym</span> & sofort Ergebnis.
          Zeigt dir, wo du mehr <span class="critical-highlight">Klarheit</span> & Ruhe bekommst.
        </p>
        <button class="btn btn-primary tap-scale" id="hero-cta" data-target="#quiz">Jetzt 2-Minuten-Check starten</button>
        <p class="social-line">â­ 4,9 / 250+ Menschen</p>
      </div>

      <!-- Ampel -->
      <div class="ampel" id="ampel" aria-label="Ampel-Status" role="img">
        <div class="ampel-light red" aria-hidden="true"></div>
        <div class="ampel-light yellow" aria-hidden="true"></div>
        <div class="ampel-light green" aria-hidden="true"></div>
      </div>
    </div>
  </header>

  <!-- Live Social Proof -->
  <section class="live-feed-section fade-up">
    <div class="wrap">
      <div id="live-feed" class="live-feed" aria-live="polite">
        <!-- JS rotiert Nachrichten -->
      </div>
    </div>
  </section>

  <!-- Proof Bars -->
  <section class="proof-section fade-up">
    <div class="wrap">
      <h2>Was Menschen am meisten hilft</h2>
      <div class="proof">
        <div class="proof-item">
          <div class="proof-top"><span>Vertrauen</span><strong>98 %</strong></div>
          <div class="proof-bar" data-value="98"><span></span></div>
        </div>
        <div class="proof-item">
          <div class="proof-top"><span>Klarheit</span><strong>92 %</strong></div>
          <div class="proof-bar" data-value="92"><span></span></div>
        </div>
        <div class="proof-item">
          <div class="proof-top"><span>Empfehlung</span><strong>91 %</strong></div>
          <div class="proof-bar" data-value="91"><span></span></div>
        </div>
      </div>
    </div>
  </section>

  <!-- Testimonials -->
  <section class="testimonial-list fade-up" id="testimonials">
    <div class="wrap">
      <h2>Kurze Stimmen von echten Menschen</h2>
      <div class="micro-t">
        <figure class="micro"><blockquote>â€HÃ¤tte nie gedacht, wie viel Ruhe das bringt.â€œ</blockquote><figcaption>â€“ Lisa, 29</figcaption></figure>
        <figure class="micro"><blockquote>â€Endlich Ruhe im Kopf. Wir haben jetzt einen klaren Plan.â€œ</blockquote><figcaption>â€“ Jan, 37</figcaption></figure>
        <figure class="micro"><blockquote>â€Wir sparen 420 â‚¬ jedes Jahr. Ohne Stress.â€œ</blockquote><figcaption>â€“ Miriam &amp; Paul</figcaption></figure>
      </div>
    </div>
  </section>

  <!-- Personas -->
  <section id="personas" class="persona-section fade-up" aria-labelledby="personas-title">
    <div class="wrap">
      <h2 id="personas-title">Was trifft am ehesten auf dich zu?</h2>
      <div class="persona-grid">
        <button class="persona-card tap-scale" type="button"
          data-key="familie"
          data-headline="Mehr Ruhe im Familienbudget â€“ ohne Papierkram."
          data-subheadline="Wir schauen gemeinsam ehrlich drauf, wo bei euch Geld liegen bleibt â€“ Schritt fÃ¼r Schritt, ohne Druck.">
          ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ Ich bin Familie
        </button>
        <button class="persona-card tap-scale" type="button"
          data-key="selbststaendig"
          data-headline="Du verdienst gut â€“ aber dein Konto fÃ¼hlt sich nicht so an?"
          data-subheadline="Wir sortieren das einmal sauber â€“ damit du weiÃŸt, was wirklich zu deinem Risiko passt.">
          ğŸ’¼ Ich bin SelbststÃ¤ndig
        </button>
        <button class="persona-card tap-scale" type="button"
          data-key="angestellt"
          data-headline="Einfach wissen, dass alles passt â€“ ohne Papierkram."
          data-subheadline="Kurzer Check, der zeigt, ob du etwas Wichtiges vergisst oder Geld liegen lÃ¤sst.">
          ğŸ§‘â€ğŸ’¼ Ich bin Angestellt
        </button>
      </div>
      <p id="persona-copy" class="persona-copy" aria-live="polite"></p>
    </div>
  </section>

  <!-- Story -->
  <section class="story-section fade-up" id="story">
    <div class="wrap">
      <h2>Warum tun sich so viele mit dem Thema Geld schwer?</h2>
      <div class="story-points stack">
        <p>Weil das Thema riesig wirkt â€“ und man Angst hat, etwas falsch zu machen.</p>
        <p>Weil niemand einem jemals gezeigt hat, worauf es wirklich ankommt.</p>
        <p>Weil die Infos Ã¼berall verteilt sind â€“ und jeder etwas anderes erzÃ¤hlt.</p>
        <p>Weil man im Alltag genug Stress hat, um sich noch mit VertrÃ¤gen zu beschÃ¤ftigen.</p>
      </div>
      <div class="story-solution surface">
        <h3>Die LÃ¶sung: einmal sauber sortieren â€“ Schritt fÃ¼r Schritt.</h3>
        <p>Die <strong>Finanz-Ampel</strong> zeigt dir in <span class="critical-highlight">2 Minuten</span>, wo du stehst â€“ ohne Papierkram, ohne Druck, komplett <span class="critical-highlight">anonym</span>.</p>
        <p>Danach weiÃŸt du: <strong>Wo Geld liegen bleibt Â· Was wichtig ist Â· Was du entspannt abhaken kannst</strong></p>
      </div>
    </div>
  </section>

  <!-- QUIZ -->
  <section id="quiz" class="quiz section fade-up" aria-labelledby="quiz-title">
    <div class="wrap">
      <h2 id="quiz-title">Der kurze 2-Minuten-Check</h2>

      <!-- ğŸ”§ Upgrade 2: Soft-Permission -->
      <p class="hero-micro" id="soft-permission" aria-live="polite">
        Es dauert nur 2&nbsp;Minuten. Du kannst jederzeit abbrechen.
      </p>

      <!-- Progress -->
      <div class="progress" aria-label="Fortschritt">
        <div class="track"></div>
        <div class="bar" id="quiz-progress-bar" role="progressbar" aria-valuemin="0" aria-valuenow="0" aria-valuemax="100"></div>
        <div class="text"><span id="quiz-step-text">1</span>/3 Â· <span id="progress-tick">Los gehtâ€™s</span></div>
      </div>

      <!-- Steps -->
      <div id="quiz-steps">
        <div class="quiz-step" data-step="1">
          <h3>Wie fÃ¼hlt sich dein Geld-Alltag aktuell an?</h3>
          <div class="answers" role="group" aria-label="Geld-Alltag">
            <button class="pill tap-scale answer" data-value="unsicher">Ich bin oft unsicher, ob ich etwas Wichtiges Ã¼bersehe.</button>
            <button class="pill tap-scale answer" data-value="keineahnung">Ich hab keine Ahnung â€“ ich schieb das Thema weg.</button>
            <button class="pill tap-scale answer" data-value="stabil">LÃ¤uft okay, aber ich weiÃŸ nicht, ob Luft nach oben ist.</button>
          </div>
        </div>

        <div class="quiz-step" data-step="2" hidden>
          <h3>Wie gut bist du abgesichert, wenn mal etwas schiefgeht?</h3>
          <div class="answers" role="group" aria-label="Absicherung">
            <button class="pill tap-scale answer" data-value="unsicher">Ich hoffe einfach, dass nichts passiert â€¦</button>
            <button class="pill tap-scale answer" data-value="keineahnung">Ich weiÃŸ es wirklich nicht.</button>
            <button class="pill tap-scale answer" data-value="stabil">Denke, es passt â€“ aber sicher bin ich nicht.</button>
          </div>
        </div>

        <div class="quiz-step" data-step="3" hidden>
          <h3>Wie viel Struktur hast du bei Versicherungen &amp; VertrÃ¤gen?</h3>
          <div class="answers" role="group" aria-label="Struktur">
            <button class="pill tap-scale answer" data-value="unsicher">Eher Chaos â€“ ich weiÃŸ nicht, was aktuell ist.</button>
            <button class="pill tap-scale answer" data-value="keineahnung">Ich habe keine Ãœbersicht.</button>
            <button class="pill tap-scale answer" data-value="stabil">Ich denke, es ist okay â€“ kÃ¶nnte aber besser sein.</button>
          </div>
        </div>
      </div>

      <!-- Result -->
      <div id="quiz-result" class="quiz-result fade-up" hidden aria-live="polite">
        <h3 id="quiz-result-title" class="result-title" tabindex="-1">Deine Ampel <span id="persona-badge" class="persona-badge" hidden>â€”</span></h3>

        <div class="ampel result-ampel" aria-label="Ergebnis Ampel" role="img">
          <span class="ampel-light ampel-red" data-lamp="rot" aria-hidden="true"></span>
          <span class="ampel-light ampel-yellow" data-lamp="gelb" aria-hidden="true"></span>
          <span class="ampel-light ampel-green" data-lamp="gruen" aria-hidden="true"></span>
        </div>

        <p id="quiz-summary-text" class="result-note">â€“</p>

        <div id="slot-container" class="slot-generator" aria-label="freie Zeiten"></div>

        <div class="result-ctas">
          <button class="btn btn-primary tap-scale" id="result-cta">15-Minuten-Check buchen</button>
          <button class="btn btn-secondary tap-scale" id="quiz-again">Nochmal starten</button>
        </div>
      </div>
    </div>
  </section>

  <!-- Referral (kurz, optional nutzbar) -->
  <section id="referral" class="referral-section fade-up">
    <div class="wrap">
      <h2>Weitergeben â€“ ohne etwas erklÃ¤ren zu mÃ¼ssen</h2>
      <p class="referral-sub">Die Ampel spricht fÃ¼r dich. Schnell, <span class="critical-highlight">anonym</span>, <span class="critical-highlight">kein Verkauf</span> â€“ einfach weiterleiten.</p>
      <div id="referral-live-feed" class="live-feed" aria-live="polite"></div>
    </div>
  </section>

  <!-- Footer / Termin -->
  <footer class="footer surface fade-up" id="termin" role="contentinfo">
    <div class="wrap">
      <h3>15-Minuten-Check mit Heiko</h3>
      <p>Kurz, ehrlich, ohne Druck. Wir schauen einmal gemeinsam drauf â€“ entspannt, ohne Fachchinesisch.</p>
      <a href="https://heikohaerter.com/termin" class="btn btn-primary tap-scale" rel="noopener">Termin finden</a>
      <div class="footer-microtrust">
        <p>ğŸ”’ <span class="critical-highlight">anonym</span> starten</p>
        <p>ğŸ¤ <span class="critical-highlight">kein Verkauf</span></p>
        <p>ğŸ’¶ <span class="critical-highlight">25 â‚¬ Garantie</span>, falls nichts fÃ¼r dich drin ist</p>
      </div>
      <div class="footer-meta">
        <p>Â© <span data-year></span> Heiko HÃ¤rter â€“ Finanzbegleitung</p>
        <p>Impressum Â· Datenschutz</p>
      </div>
    </div>
  </footer>

  <script defer src="app.js"></script>
</body>
</html>

<!-- /app.js -->
(() => {
  const $ = (s, r=document) => r.querySelector(s);
  const $$ = (s, r=document) => Array.from(r.querySelectorAll(s));

  document.documentElement.classList.remove('no-js');

  /* Loader (0.5s) â€” why: kleines Commitment/Sicherheitssignal */
  function setupLoader(){
    const el = $('#micro-loader'); if(!el) return;
    const reduce = matchMedia('(prefers-reduced-motion: reduce)').matches;
    const hide = () => el.classList.add('hide');
    if (reduce) return hide();
    setTimeout(hide, 500);
  }

  /* Smooth scroll */
  function setupSmoothScroll(){
    const handler = (e) => {
      const t = e.currentTarget;
      const href = t.getAttribute('data-target') || t.getAttribute('href');
      if (!href || !href.startsWith('#')) return;
      const target = document.querySelector(href);
      if (!target) return;
      e.preventDefault();
      target.scrollIntoView({ behavior:'smooth', block:'start' });
      if (target.tabIndex === -1) target.focus({ preventScroll:true });
    };
    $$('a[href^="#"], [data-target^="#"], #hero-cta').forEach(a => a.addEventListener('click', handler));
  }

  /* Reveal on scroll */
  function setupReveal(){
    const io = new IntersectionObserver((ents)=>{
      ents.forEach(e => e.isIntersecting && e.target.classList.add('visible'));
    }, { threshold:.12 });
    $$('.fade-up').forEach(el => io.observe(el));
  }

  /* Decision anchor show after 180px + Micro-Proof loop */
  function setupDecisionAnchor(){
    const anchor = $('#decision-anchor'); if(!anchor) return;
    let shown=false;
    const onScroll = () => { if(!shown && window.scrollY > 180){ anchor.classList.add('show'); shown=true; window.removeEventListener('scroll', onScroll);} };
    window.addEventListener('scroll', onScroll, { passive:true });

    const span = $('#micro-proof');
    const msgs = ['keine Vorbereitung notwendig','dauert nur 2 Minuten','du entscheidest â€“ nichts wird verkauft'];
    if (span){
      let i=0; const id = setInterval(()=>{ i=(i+1)%msgs.length; span.textContent = msgs[i]; }, 4000);
      window.addEventListener('pagehide', ()=>clearInterval(id));
    }
  }

  /* Sticky CTA logic */
  function setupStickyCTA(){
    const cta = $('#sticky-cta'); const hero = $('#hero'); const quiz = $('#quiz');
    if(!cta || !hero) return;

    const setVis = (show) => {
      cta.classList.toggle('show', show);
      cta.setAttribute('aria-hidden', show ? 'false' : 'true');
    };

    const ioHero = new IntersectionObserver(([e]) => {
      const show = !e.isIntersecting && window.scrollY > (document.body.scrollHeight * 0.3);
      setVis(show);
    }, { rootMargin: '-64px 0px 0px 0px' });
    ioHero.observe(hero);

    if (quiz){
      const ioQuiz = new IntersectionObserver(([e]) => {
        if (e.isIntersecting) setVis(false); // nicht drÃ¤ngeln am Quiz
      }, { threshold:.25 });
      ioQuiz.observe(quiz);
    }

    cta.addEventListener('click', () => {
      $('#quiz')?.scrollIntoView({ behavior:'smooth' });
    });
  }

  /* Live feeds */
  function rotateFeed(containerId, items){
    const box = $(containerId); if(!box) return;
    box.textContent = items[0];
    let i=0, paused=false;
    const id = setInterval(()=>{ if(paused) return; i=(i+1)%items.length; box.textContent = items[i]; }, 3500);
    ['mouseenter','focusin'].forEach(ev=>box.addEventListener(ev, ()=>paused=true));
    ['mouseleave','focusout'].forEach(ev=>box.addEventListener(ev, ()=>paused=false));
    window.addEventListener('pagehide', ()=>clearInterval(id));
  }
  function setupLiveFeeds(){
    rotateFeed('#live-feed', [
      'â€Sandra (31) hat gerade ihre Ampel gemacht.â€œ',
      'â€Leon (27) spart 420 â‚¬ im Jahr.â€œ',
      'â€Heute schon 18 Menschen Ruhe gewonnen.â€œ'
    ]);
    rotateFeed('#referral-live-feed', [
      'â€Clara (34) hat den Link weitergegeben.â€œ',
      'â€Tom (42) hat gerade gestartet â€“ 2 Minuten.â€œ',
      'â€Ohne Druck, ohne Verkauf â€“ einfach anfangen.â€œ'
    ]);
  }

  /* Proof bars */
  function setupProofBars(){
    const bars = $$('.proof-bar'); if(!bars.length) return;
    const io = new IntersectionObserver((ents)=>{
      ents.forEach(({isIntersecting, target})=>{
        if(!isIntersecting) return;
        const v = Math.min(100, Math.max(0, parseInt(target.getAttribute('data-value')||target.getAttribute('data-percentage')||'0',10)));
        const span = $('span', target); if (span) span.style.width = v + '%';
        const fill = $('.bar-fill', target); if (fill) fill.style.width = v + '%';
      });
    }, { threshold:.35 });
    bars.forEach(b => io.observe(b));
  }

  /* Personas */
  let currentPersona = '';
  function setupPersonas(){
    const out = $('#persona-copy');
    const cards = $$('.persona-card');
    function setActive(btn){
      cards.forEach(c => c.classList.remove('is-active'));
      btn.classList.add('is-active');
      currentPersona = btn.getAttribute('data-key') || '';
      const h = btn.getAttribute('data-headline') || '';
      const s = btn.getAttribute('data-subheadline') || '';
      if (out) out.textContent = `${h} ${s}`.trim();
    }
    cards.forEach(c=>{
      c.addEventListener('click', ()=>setActive(c));
      c.addEventListener('keydown', (e)=>{ if(e.key==='Enter'||e.key===' '){ e.preventDefault(); setActive(c);} });
    });
  }

  /* Quiz with Persona-Auto-Switch + Predictive texts */
  function setupQuiz(){
    const steps = $$('#quiz-steps .quiz-step');
    if(!steps.length) return;

    const bar = $('#quiz-progress-bar');
    const stepText = $('#quiz-step-text');
    const tick = $('#progress-tick');
    const soft = $('#soft-permission');

    const resultCard = $('#quiz-result');
    const resultNote = $('#quiz-summary-text');
    const personaBadge = $('#persona-badge');

    const answers = [];
    const mapVal = v => (v==='unsicher'||v==='keineahnung') ? 'rot' : 'gelb'; // Step-Mapping baseline (why: schnelle Heuristik)
    let current = 0;

    function setProgress(){
      const pct = Math.round((current/steps.length)*100);
      bar.style.width = pct + '%';
      bar.setAttribute('aria-valuenow', String(pct));
      stepText.textContent = String(Math.min(current+1, steps.length));
      const labels = ['Los gehtâ€™s','âœ“ 1 von 3 â€“ gut dabei','âœ“ 2 von 3 â€“ fast geschafft','âœ“ 3 von 3'];
      tick.textContent = labels[Math.min(current, labels.length-1)];
    }

    function showStep(i){
      steps.forEach((s,idx)=>s.hidden = idx!==i);
      resultCard.hidden = true;
      current = i;
      setProgress();
      const btn = steps[i].querySelector('.answer');
      btn && btn.focus();
    }

    function computeAmpel(){
      // rot > gelb > gruen (gruen nur bei 2â€“3Ã— stabil)
      const counts = { rot:0, gelb:0, gruen:0 };
      answers.forEach(v=>{
        if (v==='stabil') counts.gruen++;
        else if (v==='unsicher' || v==='keineahnung') counts.rot++;
        else counts.gelb++;
      });
      if (counts.gruen >= 2) return 'gruen';
      if (counts.rot >= 2) return 'rot';
      return 'gelb';
    }

    // ğŸ”§ Upgrade 3: Persona-Auto-Switch
    function autoPersona(stepIdx, value){
      if (stepIdx !== 2) return; // bei Step 3 entscheiden
      const step1 = answers[0]; const step2 = answers[1];
      let key = '';
      if (value !== 'stabil'){
        key = (step1==='stabil') ? 'angestellt' : 'familie';
      } else if (step2 === 'stabil'){
        key = 'selbststaendig';
      }
      if (!key) return;
      const btn = `.persona-card[data-key="${key}"]`;
      const el = $(btn); if (!el) return;
      $$('.persona-card').forEach(c => c.classList.remove('is-active'));
      el.classList.add('is-active');
      currentPersona = key;
      const h = el.getAttribute('data-headline') || '';
      const s = el.getAttribute('data-subheadline') || '';
      const out = $('#persona-copy'); out && (out.textContent = `${h} ${s}`.trim());
    }

    // ğŸ”§ Upgrade 4: Predictive Result Texts (4 Varianten je Farbe + Persona Appendix)
    function predictiveText(color){
      const base = {
        rot: [
          'Erstmal Ordnung schaffen â€“ wir gehen das ruhig & strukturiert an.',
          'Kein Druck: Schritt fÃ¼r Schritt, heute starten reicht.',
          'Wir sortieren das Wichtigste zuerst â€“ spÃ¼rbar weniger Chaos.',
          'Kleine Schritte, klare Reihenfolge â€“ du behÃ¤ltst die Kontrolle.'
        ],
        gelb: [
          'Schon gut â€“ mit ein paar Schritten wird es deutlich entspannter.',
          'Fast da: Wir drehen an 2â€“3 kleinen Stellschrauben.',
          'Gut im Griff â€“ jetzt clever priorisieren fÃ¼r mehr Ruhe.',
          'Einmal sauber durchgehen und die letzten LÃ¼cken schlieÃŸen.'
        ],
        gruen: [
          'Sehr stabil â€“ nur Kleinigkeiten im Blick behalten.',
          'Top Basis â€“ wir sichern ab, was wirkt.',
          'Weiter so: Mini-Checks fÃ¼r langfristige Ruhe.',
          'Feinschliff: kleine Optimierungen fÃ¼r extra Sicherheit.'
        ]
      };
      const personaAdd = {
        familie: { rot:' Fokus: Familienalltag einfacher machen.', gelb:' Mehr Ruhe im Alltag ohne Papierkram.', gruen:' Familien-Themen bleiben entspannt.' },
        angestellt: { rot:' Schnell Ordnung fÃ¼r den Arbeitsalltag.', gelb:' Klarheit, damit sich der Monat besser anfÃ¼hlt.', gruen:' Stabil weiter â€“ Check zur BestÃ¤tigung.' },
        selbststaendig: { rot:' Schwankungen abfedern, Risiken sortieren.', gelb:' LiquiditÃ¤t & Absicherung sauber justieren.', gruen:' Stabil â€“ Reserve & Absicherung kurz prÃ¼fen.' },
        '': { rot:'', gelb:'', gruen:'' }
      };
      const list = base[color] || base.gelb;
      const pick = list[Math.floor(Math.random()*list.length)];
      return pick + (personaAdd[currentPersona]?.[color] || '');
    }

    function paintAmpel(color){
      $$('[data-lamp]').forEach(l => l.classList.remove('ampel--active'));
      const act = $(`[data-lamp="${color}"]`);
      act && act.classList.add('ampel--active');
    }

    function genSlots(){
      const box = $('#slot-container'); if(!box) return;
      box.innerHTML = '';
      const times = ['09:30','11:00','13:00','15:30','18:00'];
      const days = 5;
      for (let i=0;i<days;i++){
        const d=new Date(); d.setDate(d.getDate()+i);
        const el = document.createElement('div');
        el.className = 'slot ' + (i===0?'slot-today': i===1?'slot-tomorrow':'');
        el.textContent = `${d.toLocaleDateString('de-DE',{weekday:'short', day:'2-digit', month:'2-digit'})} Â· ${times[i%times.length]} Uhr`;
        box.appendChild(el);
      }
    }

    function updatePersonaBadge(){
      const map = { familie:'Familie', angestellt:'Angestellt', selbststaendig:'SelbststÃ¤ndig' };
      if (!currentPersona){ personaBadge.hidden = true; return; }
      personaBadge.hidden = false; personaBadge.textContent = map[currentPersona] || currentPersona;
    }

    function showResult(){
      steps.forEach(s => s.hidden = true);
      const color = computeAmpel();
      paintAmpel(color);
      resultNote.textContent = predictiveText(color);
      genSlots();
      updatePersonaBadge();
      resultCard.hidden = false;
      $('#quiz-result-title')?.focus();
      bar.style.width = '100%'; bar.setAttribute('aria-valuenow','100');
      $('#quiz-step-text').textContent = String(steps.length);
      $('#progress-tick').textContent = 'âœ“ 3 von 3';
    }

    steps.forEach((stepEl, idx)=>{
      stepEl.addEventListener('click', (e)=>{
        const btn = e.target.closest('.answer'); if (!btn) return;
        const val = btn.getAttribute('data-value'); if (!val) return;
        answers[idx] = val;

        if (soft) soft.style.display = 'none';
        autoPersona(idx, val);

        const next = idx+1;
        if (next < steps.length) {
          steps[idx].hidden = true; steps[next].hidden = false; current = next; setProgress();
        } else {
          showResult();
        }
      });
    });

    $('#quiz-again')?.addEventListener('click', ()=>{
      answers.length = 0;
      steps.forEach((s,i)=> s.hidden = i!==0);
      current = 0; setProgress();
      resultCard.hidden = true;
      if (soft) soft.style.display = '';
      currentPersona = '';
      $('#persona-copy') && ($('#persona-copy').textContent = '');
      personaBadge.hidden = true;
      $$('.persona-card').forEach(c=>c.classList.remove('is-active'));
    });

    setProgress();
  }

  /* Bottom nav active link */
  function setupBottomNav(){
    const sections = [
      ['#hero', $('#bottom-nav a[href="#hero"]')],
      ['#quiz', $('#bottom-nav a[href="#quiz"]')],
      ['#referral', $('#bottom-nav a[href="#referral"]')],
      ['#termin', $('#bottom-nav a[href="#termin"]')]
    ].filter(([id,link])=> document.querySelector(id) && link);

    const io = new IntersectionObserver((ents)=>{
      ents.forEach(e=>{
        if(e.isIntersecting){
          sections.forEach(([_,link])=> link.classList.remove('is-active'));
          const item = sections.find(([id])=> '#'+e.target.id===id);
          item && item[1].classList.add('is-active');
        }
      });
    }, { threshold:.5 });

    sections.forEach(([id])=> io.observe(document.querySelector(id)));
  }

  /* Year */
  function setupYear(){ $$('[data-year]').forEach(n=> n.textContent = String(new Date().getFullYear())); }

  document.addEventListener('DOMContentLoaded', ()=>{
    setupLoader();
    setupSmoothScroll();
    setupReveal();
    setupDecisionAnchor();
    setupStickyCTA();
    setupLiveFeeds();
    setupProofBars();
    setupPersonas();
    setupQuiz();
    setupBottomNav();
    setupYear();
  });
})();
