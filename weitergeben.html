<!-- /index.html -->
<!DOCTYPE html>
<html lang="de" translate="no" class="no-js">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="color-scheme" content="dark light" />
  <meta name="theme-color" content="#0b0f14" />
  <title>Weitergeben â€“ ruhig, zero-pressure, ohne etwas erklÃ¤ren zu mÃ¼ssen</title>
  <meta name="description" content="Weitergeben â€“ ohne erklÃ¤ren zu mÃ¼ssen. Die Ampel spricht fÃ¼r dich. 2 Minuten. anonym. kein Verkauf. ruhig. einfach. zero-pressure. FÃ¼r Freunde, Familie, Kollegen, SelbststÃ¤ndige." />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <!-- ğŸ”§ Micro-Commitment Loader (0.5s) -->
  <div id="micro-loader" class="micro-loader" role="status" aria-live="polite">
    <div class="micro-loader-box">
      <div class="micro-loader-dot" aria-hidden="true"></div>
      <p class="micro-loader-text">Seite ist bereit â€“ du entscheidest</p>
    </div>
  </div>

  <a class="skip-link" href="#main">Zum Inhalt springen</a>

  <!-- Decision Anchor + Micro-Proof Loop -->
  <div id="decision-anchor" class="decision-anchor" role="note" aria-live="polite">
    ğŸ”’ 100% anonym Â· kein Verkauf Â· 25 â‚¬ Garantie Â·
    <span id="micro-proof" class="micro-proof">keine Vorbereitung notwendig</span>
  </div>

  <!-- Sticky CTA -->
  <div id="sticky-cta" class="sticky-cta" aria-hidden="true">
    <div class="inner">
      <button class="btn-primary tap-scale" data-target="#referral-engine">ğŸ‘‰ Jetzt ruhig weitergeben</button>
    </div>
  </div>

  <!-- HEADER -->
  <header class="site-header" role="banner">
    <div class="wrap header-bar">
      <a class="brand" href="/" aria-label="Startseite">
        <span class="brand-dot" aria-hidden="true"></span>
        <span class="brand-name">Ruhige Finanz-Ampel</span>
        <span class="brand-tag">anonym Â· kein Druck Â· alltagstauglich</span>
      </a>
    </div>
  </header>

  <main id="main">
    <!-- HERO -->
    <section id="hero" class="hero section fade-up" aria-labelledby="hero-title">
      <div class="wrap hero-wrap">
        <div>
          <h1 id="hero-title">Weitergeben â€“ ohne etwas erklÃ¤ren zu mÃ¼ssen.</h1>
          <p class="sub">Die Ampel macht alles. 2 Minuten. anonym. kein Verkauf. ruhig & klar.</p>
          <div class="hero-benefits">
            <span class="chip">ruhig</span>
            <span class="chip">einfach</span>
            <span class="chip">zero-pressure</span>
            <span class="chip">fÃ¼r alle verstÃ¤ndlich</span>
            <span class="chip">25 â‚¬ Vorteil-Garantie</span>
          </div>
        </div>
      </div>
    </section>

    <!-- REFERRAL ENGINE -->
    <section id="referral-engine" class="section referral-engine fade-up" aria-labelledby="ref2-title">
      <div class="wrap">
        <h2 id="ref2-title">In 2 Minuten weitergeben</h2>
        <p class="context-line">
          FÃ¼r Freunde, Familie, Kollegen. <strong>anonym</strong>, <strong>kein Verkauf</strong>, <strong>ruhig</strong>.
          Du gibst nur den Link weiter â€“ der Rest passiert automatisch.
        </p>

        <!-- Zielgruppe -->
        <fieldset class="ref2-group" aria-labelledby="ref2-ziel-label">
          <legend id="ref2-ziel-label">Zielgruppe wÃ¤hlen</legend>
          <div class="btn-row" role="group" aria-label="Zielgruppe">
            <button type="button" class="btn tap-scale ref2-seg" data-seg="freund" aria-pressed="false">Freund</button>
            <button type="button" class="btn tap-scale ref2-seg" data-seg="familie" aria-pressed="false">Familie</button>
            <button type="button" class="btn tap-scale ref2-seg" data-seg="kollege" aria-pressed="false">Kollege</button>
            <button type="button" class="btn tap-scale ref2-seg" data-seg="selbststaendig" aria-pressed="false">SelbststÃ¤ndig</button>
          </div>
        </fieldset>

        <!-- TonalitÃ¤t -->
        <fieldset class="ref2-group" aria-labelledby="ref2-tone-label">
          <legend id="ref2-tone-label">TonalitÃ¤t wÃ¤hlen</legend>
          <div class="btn-row" role="group" aria-label="TonalitÃ¤t">
            <button type="button" class="btn tap-scale ref2-tone" data-tone="locker" aria-pressed="true">locker</button>
            <button type="button" class="btn tap-scale ref2-tone" data-tone="kurz" aria-pressed="false">kurz</button>
            <button type="button" class="btn tap-scale ref2-tone" data-tone="ergebnisorientiert" aria-pressed="false">ergebnisorientiert</button>
            <button type="button" class="btn tap-scale ref2-tone" data-tone="familie" aria-pressed="false">familie</button>
            <button type="button" class="btn tap-scale ref2-tone" data-tone="selbststÃ¤ndig" aria-pressed="false">selbststÃ¤ndig</button>
          </div>
        </fieldset>

        <!-- Name -->
        <div class="ref2-field">
          <label for="ref2-name">Optionaler Name</label>
          <input id="ref2-name" placeholder="Vorname fÃ¼r persÃ¶nliche Note (optional)" autocomplete="given-name" inputmode="text">
          <p class="hint">Alles bleibt <strong>anonym</strong>. Der Name erzeugt nur NÃ¤he.</p>
        </div>

        <!-- WhatsApp Preview -->
        <div class="wa-preview" role="region" aria-labelledby="wa-prev-title">
          <h3 id="wa-prev-title">WhatsApp Preview</h3>

          <div class="wa-bubble" aria-live="polite">
            <div class="wa-meta">
              <span class="wa-name">Kontakt</span>
              <span class="wa-time">jetzt</span>
            </div>
            <div class="wa-msg">
              <p id="ref2-message">Hey ğŸ‘‹ ich hab grad den Kurz-Check gemacht. War super entspannt. Probier mal â€“ dauert 2 Minuten: {{URL}}</p>
            </div>
            <div class="wa-typing" aria-hidden="true">
              <span class="dot"></span><span class="dot"></span><span class="dot"></span>
            </div>
          </div>

          <div class="actions">
            <button class="btn btn-secondary" id="ref2-copy">ğŸ“‹ Text kopieren</button>
            <button class="btn btn-primary tap-scale" id="ref2-share">ğŸ’¬ WhatsApp teilen</button>
          </div>

          <p class="privacy-note">anonym Â· kein Verkauf Â· 2 Minuten Â· ruhig Â· Vorteil fÃ¼r beide Seiten</p>
        </div>
      </div>
    </section>

    <!-- TEMPLATE JSON -->
    <script type="application/json" id="ref2-templates">
    {
      "Locker": "Hey{{NAME}}, ich hab grad den Kurz-Check gemacht. War super entspannt. Probier mal â€“ dauert 2 Minuten: {{URL}}",
      "Kurz": "Kurzer Tipp{{NAME}}: Kurz-Check â†’ {{URL}}",
      "Ergebnisorientiert": "Ich war Ã¼berrascht, wie viel Ãœberblick man in 2 Minuten bekommt ğŸ˜… anonym & kein Druck: {{URL}}",
      "Familie": "Hab direkt an euch gedacht{{NAME}}: kurzer Eltern-Check (2 Min) â€“ zeigt sofort, ob etwas fehlt ğŸ‘‰ {{URL}}",
      "SelbststÃ¤ndig": "FÃ¼r SelbststÃ¤ndige wie dich{{NAME}}: kurzer Blick, ob dein Alltag gut abgesichert ist â€“ anonym & ruhig ğŸ‘‰ {{URL}}"
    }
    </script>

    <!-- NEURO UX -->
    <section class="section neuro fade-up" aria-labelledby="neuro-title">
      <div class="wrap">
        <h2 id="neuro-title">Sicher weitergeben â€“ ruhig & ohne Druck</h2>

        <!-- Proof -->
        <div class="proof">
          <div class="proof-item">
            <div class="proof-top"><span>Vertrauen</span><strong>98 %</strong></div>
            <div class="proof-bar" data-value="98"><span></span></div>
          </div>
          <div class="proof-item">
            <div class="proof-top"><span>Ruhe im Kopf</span><strong>92 %</strong></div>
            <div class="proof-bar" data-value="92"><span></span></div>
          </div>
          <div class="proof-item">
            <div class="proof-top"><span>Empfohlen</span><strong>91 %</strong></div>
            <div class="proof-bar" data-value="91"><span></span></div>
          </div>
        </div>

        <!-- Live Feed -->
        <div class="live-feed">
          <ul id="live-messages">
            <li>â€Sandra (31) hat gerade ihre Ampel gemacht.â€œ</li>
            <li>â€Leon (27) spart 420 â‚¬ im Jahr.â€œ</li>
            <li>â€Heute schon 18 Menschen Ruhe gewonnen.â€œ</li>
          </ul>
        </div>

        <!-- Micro Testimonials -->
        <div class="micro-t">
          <figure class="micro">
            <blockquote>â€HÃ¤tte nie gedacht, dass 2 Minuten so viel Ruhe bringen.â€œ</blockquote>
            <figcaption>â€“ Lisa, 29</figcaption>
          </figure>
          <figure class="micro">
            <blockquote>â€Endlich Ruhe im Kopf â€“ wir wissen jetzt, was heute wichtig ist.â€œ</blockquote>
            <figcaption>â€“ Jan, 37</figcaption>
          </figure>
          <figure class="micro">
            <blockquote>â€Wir sparen 420 â‚¬ im Jahr und fÃ¼hlen uns sicherer.â€œ</blockquote>
            <figcaption>â€“ Miriam &amp; Paul</figcaption>
          </figure>
        </div>

        <!-- Story -->
        <article class="storyblock">
          <h3>Warum deine Empfehlung wichtig ist</h3>
          <p>Viele schieben das Thema â€“ Alltag, Unsicherheit, Mental Load. In <strong>2 Minuten</strong> bekommen sie ein ruhiges Bild.</p>
          <ul class="bullets">
            <li><strong>anonym</strong> â€“ niemand muss etwas preisgeben</li>
            <li><strong>kein Verkauf</strong> â€“ einfach ein Blick</li>
            <li><strong>klar</strong> â€“ Ampel zeigt Rot Â· Gelb Â· GrÃ¼n</li>
            <li><strong>ruhig</strong> â€“ kein Druck, kein Aufwand</li>
          </ul>
          <p>Du hilfst, ohne zu erklÃ¤ren. Die Ampel macht alles.</p>
        </article>
      </div>
    </section>

    <!-- Bottom Nav -->
    <nav class="bottom-nav" aria-label="Untere Navigation">
      <a href="/" class="nav-item">ğŸ  <span>Home</span></a>
      <a href="/#quiz" class="nav-item">ğŸš¦ <span>Check</span></a>
      <a href="#referral-engine" class="nav-item">ğŸ’¬ <span>Weitergeben</span></a>
      <a href="#contact" class="nav-item">ğŸ“ <span>Kontakt</span></a>
    </nav>

    <!-- CONTACT -->
    <section id="contact" class="contact section fade-up">
      <div class="wrap">
        <h2>Kontakt â€“ kurz & ruhig</h2>
        <p>Wenn Fragen sind: kurzer Austausch. kein Druck.</p>
        <ul class="contact-list">
          <li><a href="mailto:hi@example.com">hi@example.com</a></li>
          <li><a href="tel:+490000000000">+49 000 000 00000</a></li>
        </ul>
        <p class="legal">Â© <span data-year></span> Ruhige Finanz-Ampel Â· Impressum Â· Datenschutz</p>
      </div>
    </section>
  </main>

  <script defer src="app.js"></script>
</body>
</html>

<!-- /styles.css -->
:root{
  --bg:#0b0f14; --bg-elev:#121821; --fg:#e9eef5; --muted:#9fb0c6;
  --brand:#6dd3ff; --accent:#9effa3; --red:#ff6b6b; --yellow:#ffd166; --green:#2dd36f;
  --ring:#88c0ff; --shadow:0 10px 30px rgba(0,0,0,.25);
}
@media (prefers-color-scheme: light){
  :root{ --bg:#fbfdff; --bg-elev:#fff; --fg:#0b0f14; --muted:#516077; --ring:#2666c9; }
}
*{box-sizing:border-box}
html,body{height:100%}
body{margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,"Helvetica Neue",Arial,sans-serif; background:var(--bg); color:var(--fg); line-height:1.6; -webkit-font-smoothing:antialiased; text-rendering:optimizeLegibility}
a{color:inherit} img{max-width:100%; height:auto; display:block}
.no-js .tap-scale{transform:none}
.skip-link{position:absolute; left:-9999px; width:1px; height:1px; overflow:hidden}
.skip-link:focus{left:1rem; top:1rem; width:auto; height:auto; background:var(--fg); color:var(--bg); padding:.5rem .75rem; border-radius:.5rem; box-shadow:var(--shadow)}
.wrap{max-width:1080px; margin:0 auto; padding:0 1rem}
.site-header{position:sticky; top:0; z-index:40; background:color-mix(in oklab, var(--bg) 80%, transparent); backdrop-filter:blur(8px); border-bottom:1px solid color-mix(in oklab, var(--fg) 10%, transparent)}
.header-bar{display:flex; align-items:center; justify-content:space-between; min-height:64px}
.brand{display:flex; align-items:center; gap:.6rem; text-decoration:none}
.brand-dot{width:.9rem; height:.9rem; background:var(--brand); border-radius:999px; box-shadow:0 0 0 6px color-mix(in oklab, var(--brand) 30%, transparent)}
.brand-name{font-weight:700} .brand-tag{opacity:.7; font-size:.9rem}
.section{padding:4rem 0}
.hero .sub{opacity:.9; max-width:52ch}
.hero-benefits{display:flex; flex-wrap:wrap; gap:.5rem; margin-top:1rem}
.chip{border:1px solid color-mix(in oklab, var(--fg) 12%, transparent); border-radius:999px; padding:.25rem .6rem; color:var(--muted)}
.proof{display:grid; grid-template-columns:repeat(auto-fit, minmax(220px,1fr)); gap:1rem}
.proof-item{background:var(--bg-elev); padding:1rem; border-radius:1rem; box-shadow:var(--shadow)}
.proof-top{display:flex; align-items:baseline; justify-content:space-between; gap:1rem}
.proof-bar{height:10px; background:color-mix(in oklab, var(--fg) 10%, transparent); border-radius:999px; overflow:hidden}
.proof-bar span{display:block; height:100%; width:0%; background:var(--accent)}
.live-feed{margin-top:1rem; background:var(--bg-elev); border-radius:1rem; padding:.75rem 1rem}
#live-messages{margin:0; padding:.25rem 1rem; list-style:disc; color:var(--muted)}
.micro-t{display:grid; grid-template-columns:repeat(auto-fit, minmax(220px,1fr)); gap:1rem; margin-top:1rem}
.micro{background:var(--bg-elev); padding:1rem; border-radius:1rem}
.storyblock{margin-top:1rem}
.bullets{list-style:disc; margin-left:1.25rem}

.referral-engine .context-line{color:var(--muted)}
.ref2-group{margin:1rem 0}
.btn-row{display:flex; flex-wrap:wrap; gap:.5rem}
.ref2-field{margin:1rem 0}
.ref2-field input{width:100%; padding:.7rem .9rem; border-radius:.7rem; border:1px solid color-mix(in oklab, var(--fg) 12%, transparent); background:var(--bg-elev); color:var(--fg)}
.hint{color:var(--muted); font-size:.9rem}
.wa-preview{margin-top:1.25rem}
.wa-bubble{background:var(--bg-elev); border:1px solid color-mix(in oklab, var(--fg) 10%, transparent); border-radius:1rem; padding:1rem; position:relative}
.wa-meta{display:flex; justify-content:space-between; color:var(--muted); font-size:.9rem}
.wa-msg p{margin:.6rem 0 0}
.wa-typing{display:flex; gap:.25rem; position:absolute; right:1rem; bottom:1rem}
.dot{width:6px; height:6px; border-radius:999px; background:var(--muted); opacity:.6; animation:blink 1.2s infinite ease-in-out}
.dot:nth-child(2){animation-delay:.2s} .dot:nth-child(3){animation-delay:.4s}
@keyframes blink{0%,80%,100%{opacity:.2} 40%{opacity:1}}

.actions{display:flex; gap:.5rem; margin-top:.75rem}
.btn,.btn-primary,.btn-secondary{appearance:none; border:0; padding:.8rem 1rem; border-radius:.8rem; cursor:pointer; text-decoration:none; display:inline-flex; align-items:center; justify-content:center}
.btn{background:transparent; border:1px solid color-mix(in oklab, var(--fg) 15%, transparent)}
.btn-secondary{background:transparent; border:1px solid color-mix(in oklab, var(--fg) 15%, transparent)}
.btn-primary{background:var(--brand); color:#072331; font-weight:700}
.tap-scale{transform:translateZ(0); transition:transform .12s ease}
.tap-scale:active{transform:scale(.98)}
.btn[aria-pressed="true"]{border-color:var(--brand); box-shadow:0 0 0 3px color-mix(in oklab, var(--brand) 35%, transparent)}

.bottom-nav{position:sticky; bottom:0; inset-inline:0; z-index:10; background:color-mix(in oklab, var(--bg) 88%, transparent); backdrop-filter:blur(6px); border-top:1px solid color-mix(in oklab, var(--fg) 10%, transparent)}
.bottom-nav{display:flex; justify-content:space-around; padding:.4rem .5rem}
.bottom-nav .nav-item{text-decoration:none; display:flex; gap:.4rem; align-items:center; padding:.4rem .6rem; border-radius:.6rem}
.bottom-nav .nav-item:focus-visible{outline:2px solid var(--ring); outline-offset:3px}

.contact .contact-list{list-style:none; padding:0; margin:.75rem 0}
.legal{color:var(--muted)}

.section.fade-up{opacity:0; translate:0 10px}
.section.fade-up.is-visible{opacity:1; translate:0 0; transition:opacity .4s ease, translate .4s ease}

.site-footer{border-top:1px solid color-mix(in oklab, var(--fg) 10%, transparent); padding:2rem 0}
.decision-anchor{
  position:fixed; left:50%; transform:translateX(-50%); bottom:1rem; z-index:50;
  background:var(--bg-elev); color:var(--fg); border:1px solid color-mix(in oklab, var(--fg) 12%, transparent);
  border-radius:999px; padding:.5rem .9rem; box-shadow:var(--shadow); display:flex; gap:.5rem; align-items:center; flex-wrap:wrap;
}
.micro-proof{opacity:.95}
.sticky-cta{position:sticky; bottom:0; inset-inline:0; z-index:30; opacity:0; pointer-events:none; transform:translateY(8px)}
.sticky-cta .inner{max-width:1080px; margin:0 auto; padding:0 1rem 1rem; display:flex; justify-content:flex-end}
.sticky-cta.is-on{opacity:1; pointer-events:auto; transform:none; transition:opacity .25s ease, transform .25s ease}

:focus-visible{outline:2px solid var(--ring); outline-offset:3px; border-radius:.5rem}

/* Loader */
.micro-loader{position:fixed; inset:0; background:color-mix(in oklab, var(--bg) 85%, black); display:grid; place-items:center; z-index:100; opacity:1; transition:opacity .25s ease, visibility .25s ease; visibility:visible}
.micro-loader.hide{opacity:0; visibility:hidden}
.micro-loader-box{background:var(--bg-elev); padding:1rem 1.25rem; border-radius:1rem; border:1px solid color-mix(in oklab, var(--fg) 12%, transparent); box-shadow:var(--shadow); display:flex; align-items:center; gap:.75rem}
.micro-loader-dot{width:10px; height:10px; border-radius:999px; background:var(--brand); animation:pulse .9s infinite ease-in-out}
.micro-loader-text{margin:0; color:var(--fg)}
@keyframes pulse{0%,100%{opacity:.3; transform:scale(.9)} 50%{opacity:1; transform:scale(1)}}

/* reduced motion */
@media (prefers-reduced-motion: reduce){
  *{animation-duration:.001ms !important; animation-iteration-count:1 !important; transition-duration:.001ms !important; scroll-behavior:auto !important;}
}

/* /app.js */
(() => {
  const $ = (sel, root=document) => root.querySelector(sel);
  const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));

  // Remove no-js
  document.documentElement.classList.remove('no-js');

  // Micro-loader (0.5s)
  function setupMicroLoader(){
    const el = $('#micro-loader'); if(!el) return;
    const reduce = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
    const hide = () => el.classList.add('hide');
    if (reduce) return hide();
    setTimeout(hide, 500);
  }

  // Smooth scroll
  function setupSmoothScroll(){
    const handler = (e) => {
      const t = e.currentTarget;
      const hash = t.getAttribute('data-target') || t.getAttribute('href');
      if(!hash || !hash.startsWith('#')) return;
      const el = document.querySelector(hash); if(!el) return;
      e.preventDefault();
      el.scrollIntoView({ behavior:'smooth', block:'start' });
      if (el.tabIndex === -1) el.focus({ preventScroll:true });
    };
    $$('a[href^="#"], [data-target^="#"]').forEach(n => n.addEventListener('click', handler));
  }

  // Reveal
  function setupReveal(){
    const io = new IntersectionObserver((ents)=>{
      ents.forEach(e => e.isIntersecting && e.target.classList.add('is-visible'));
    }, { threshold: .12 });
    $$('.section.fade-up').forEach(s => io.observe(s));
  }

  // Sticky CTA after hero out
  function setupStickyCTA(){
    const bar = $('#sticky-cta'); const hero = $('#hero');
    if(!bar || !hero) return;
    const io = new IntersectionObserver(([e])=>{
      const off = !e.isIntersecting;
      bar.classList.toggle('is-on', off);
      bar.setAttribute('aria-hidden', off ? 'false' : 'true');
    }, { rootMargin: '-64px 0px 0px 0px' });
    io.observe(hero);
  }

  // Proof bars
  function setupProofBars(){
    const bars = $$('.proof-bar'); if(!bars.length) return;
    const io = new IntersectionObserver((ents)=>{
      ents.forEach(({isIntersecting, target})=>{
        if(!isIntersecting) return;
        const v = Math.min(100, Math.max(0, parseInt(target.getAttribute('data-value')||'0',10)));
        const span = $('span', target); span.style.width = v + '%';
      });
    }, { threshold: .4 });
    bars.forEach(b => io.observe(b));
  }

  // Live feed rotate
  function setupLiveFeed(){
    const ul = $('#live-messages'); if(!ul) return;
    let idx=0, paused=false;
    const items = $$('#live-messages li'); if(items.length<=1) return;
    const id = setInterval(()=>{ if(!paused){ idx=(idx+1)%items.length; ul.append(items[idx]); }}, 3500);
    ['mouseenter','focusin'].forEach(ev=>ul.addEventListener(ev, ()=>paused=true));
    ['mouseleave','focusout'].forEach(ev=>ul.addEventListener(ev, ()=>paused=false));
    window.addEventListener('pagehide', ()=>clearInterval(id));
  }

  // Micro-Proof loop
  function setupMicroProofLoop(){
    const span = $('#micro-proof'); if(!span) return;
    const msgs = [
      'keine Vorbereitung notwendig',
      'dauert nur 2 Minuten',
      'du entscheidest â€“ nichts wird verkauft'
    ];
    let i=0;
    const id = setInterval(()=>{ i=(i+1)%msgs.length; span.textContent = msgs[i]; }, 4000);
    window.addEventListener('pagehide', ()=>clearInterval(id));
  }

  // Referral engine
  function setupReferral(){
    const segBtns = $$('.ref2-seg');
    const toneBtns = $$('.ref2-tone');
    const nameInput = $('#ref2-name');
    const msgEl = $('#ref2-message');
    const copyBtn = $('#ref2-copy');
    const shareBtn = $('#ref2-share');
    const tmplEl = $('#ref2-templates');

    if(!msgEl || !tmplEl) return;

    const tmpls = JSON.parse(tmplEl.textContent || '{}');

    // Map Toneâ†’Template key
    const toneKey = (tone) => {
      switch(tone){
        case 'locker': return 'Locker';
        case 'kurz': return 'Kurz';
        case 'ergebnisorientiert': return 'Ergebnisorientiert';
        case 'familie': return 'Familie';
        case 'selbststÃ¤ndig':
        case 'selbststaendig': return 'SelbststÃ¤ndig';
        default: return 'Locker';
      }
    };

    // Simple segmentâ†’default tone bias (only if user didnâ€™t change tone yet)
    let state = {
      seg: '', tone: 'locker', name: '', toneTouched: false
    };

    function setPressed(group, el){
      group.forEach(b => b.setAttribute('aria-pressed', String(b===el)));
    }

    function defaultToneForSeg(seg){
      if (seg === 'familie') return 'familie';
      if (seg === 'selbststaendig') return 'selbststÃ¤ndig';
      return 'locker';
    }

    function currentURL(){
      // Ziel: direkt zum Quiz
      const u = new URL(window.location.href);
      return `${u.origin}/#quiz`;
    }

    function render(){
      const key = toneKey(state.tone);
      let t = tmpls[key] || tmpls['Locker'] || 'Hey{{NAME}}: {{URL}}';
      const namePart = state.name ? ` ${state.name}` : '';
      t = t.replace('{{NAME}}', namePart).replace('{{URL}}', currentURL());
      msgEl.textContent = t;
    }

    segBtns.forEach(b=>{
      b.addEventListener('click', ()=>{
        setPressed(segBtns, b);
        state.seg = b.getAttribute('data-seg') || '';
        if(!state.toneTouched){
          state.tone = defaultToneForSeg(state.seg);
          const toneMatch = Array.from(toneBtns).find(tb => (tb.getAttribute('data-tone')||'') === state.tone);
          toneMatch && setPressed(toneBtns, toneMatch);
        }
        render();
      });
    });

    toneBtns.forEach(b=>{
      b.addEventListener('click', ()=>{
        setPressed(toneBtns, b);
        state.tone = b.getAttribute('data-tone') || 'locker';
        state.toneTouched = true;
        render();
      });
    });

    nameInput?.addEventListener('input', ()=>{
      state.name = (nameInput.value || '').trim();
      render();
    });

    // Copy
    copyBtn?.addEventListener('click', async ()=>{
      const text = msgEl.textContent || '';
      try{
        await navigator.clipboard.writeText(text);
        copyBtn.textContent = 'âœ… Kopiert';
        setTimeout(()=>copyBtn.textContent='ğŸ“‹ Text kopieren', 1500);
      }catch{
        // Fallback (nur wenn Auswahl erlaubt ist)
        const ta = document.createElement('textarea');
        ta.value = text; document.body.appendChild(ta); ta.select();
        try{ document.execCommand('copy'); }catch{}
        ta.remove();
      }
    });

    // Share
    shareBtn?.addEventListener('click', async ()=>{
      const text = msgEl.textContent || '';
      const url = `https://wa.me/?text=${encodeURIComponent(text)}`;
      // Prefer Web Share API if available (keine Tracking-Daten)
      if (navigator.share && /Mobile|Android|iPhone/i.test(navigator.userAgent)) {
        try{
          await navigator.share({ text });
          return;
        }catch{/* intentional: fallback below */}
      }
      window.open(url, '_blank', 'noopener,noreferrer');
    });

    // init
    render();
  }

  // Year
  function setupYear(){
    const y = String(new Date().getFullYear());
    $$('[data-year]').forEach(n => n.textContent = y);
  }

  document.addEventListener('DOMContentLoaded', () => {
    setupMicroLoader();
    setupSmoothScroll();
    setupReveal();
    setupStickyCTA();
    setupProofBars();
    setupLiveFeed();
    setupMicroProofLoop();
    setupReferral();
    setupYear();
  });
})();
